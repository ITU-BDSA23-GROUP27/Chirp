@page "/"
@model Chirp.Web.Pages.PublicModel
@{
    ViewData["Title"] = "Chirp!";
    Layout = "Shared/_Layout";
}

<div>
    <h2>Write Author's Cheep</h2>

    <div class="form-container">
        <form>
            <div class="form-group">
                <label for="author">Author:</label>
                <input type="text" id="author" name="author" required>
            </div>
            <div class="form-group">
                <label for="text">Text:</label>
                <textarea id="text" name="text" rows="5" maxlength="@Model.CheepMaxLength" required></textarea>
                <p class="char-count">Characters: <span id="char-counter">0</span>/@Model.CheepMaxLength</p>
            </div>
            <div class="button-container">
                <button type="submit">Submit</button>
                <button type="button">Close</button>
            </div>
        </form>
    </div>

    <hr />

    <header>
        <h2> Public Timeline </h2>
        <span class="display-page"> Page @Model.CurrentPage/@Model.TotalPageCount </span>
    </header>

    @if (Model.Cheeps.Any())
    {
        <ul id="message-list" class="cheeps">
            @foreach (var cheep in Model.Cheeps)
            {
                @* <li>
                    <p id="cheep-content">
                        <strong>
                            <a id="author" href="/@cheep.AuthorName">@cheep.AuthorName</a>
                        </strong>
                        @cheep.Message
                        <small>&mdash; @cheep.TimeStamp</small>
                    </p>
                </li> *@
                <li>
                    <div class="cheep-container">
                        <div class="left-content">
                            <p id="cheep-content">
                                <strong>
                                    <a id="author" href="/@cheep.AuthorName">@cheep.AuthorName</a>
                                </strong>
                            </p>
                            <p id="cheep-content">
                                <small>@cheep.TimeStamp</small>
                            </p>
                        </div>
                        <div class="right-content">
                            <p id="cheep-content">
                                @cheep.Message
                            </p>
                        </div>
                    </div>
                </li>
            }
        </ul>

        <ul class="pagination">
            @if (Model.CurrentPage > 1)
            {
                <li class="page-item prev-button">
                    <a class="page-link" href="?page=1"><i class="fas fa-angle-double-left"></i></a>
                </li>
                <li class="page-item prev-button">
                    <a class="page-link" href="?page=@(Model.CurrentPage - 1)"><i class="fas fa-angle-left"></i></a>
                </li>
            }

            @if (Model.StartPage > 1)
            {
                    <li class="page-item disabled">
                        <span class="page-link">...</span>
                    </li>
            }

            @for (var i = Model.StartPage; i <= Model.EndPage; i++)
            {
                <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                    <a class="page-link page-number" href="?page=@i">@i</a>
                </li>
            }

            @if (Model.EndPage < Model.TotalPageCount)
            {
                <li class="page-item disabled">
                    <span class="page-link">...</span>
                </li>
            }

            @if (Model.CurrentPage < Model.TotalPageCount)
            {
                <li class="page-item next-button">
                    <a class="page-link" href="?page=@(Model.CurrentPage + 1)"><i class="fas fa-angle-right"></i></a>
                <li class="page-item next-button">
                    <a class="page-link" href="?page=@Model.TotalPageCount"><i class="fas fa-angle-double-right"></i></a>
                </li>
                </li>
            }
        </ul>

    }
    else
    {
        <em>There are no cheeps so far.</em>
    }
</div>

<script>
    // next/previous page
    document.addEventListener('keydown', function (event) {
        if (event.key === 'ArrowLeft') {
            if (@Model.CurrentPage > 1) {
                window.location.href = '?page=' + (@Model.CurrentPage - 1);
            }
        } else if (event.key === 'ArrowRight') {
            if (@Model.CurrentPage < @Model.TotalPageCount) {
                window.location.href = '?page=' + (@Model.CurrentPage + 1);
            }
        }
    });

    // textarea
    const textArea = document.getElementById("text");
    const charCounter = document.getElementById("char-counter");
    
    textArea.addEventListener("input", function () {
        charCounter.textContent = textArea.value.length;
    });
</script>


